<!DOCTYPE html>
<html>
<head>
  <title>Admin - Manage Users</title>
  <link rel="icon" href="1logo.png" type="image/png">
</head>
<body>
  <h2>Manage Users</h2>
  <table border="1" id="user-table"></table>
  <h3>Add/Edit User</h3>
  <input id="new-username" placeholder="Username">
  <input id="new-password" placeholder="Password">
  <select id="new-role">
    <option value="admin">Admin</option>
    <option value="cashier">Cashier</option>
  </select>
  <button onclick="saveUser()">Save User</button>
  <script>
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser || currentUser.role !== "admin") {
      alert("Access denied");
      window.location.href = "index.html";
    }
    let users = JSON.parse(localStorage.getItem("users")) || [];
    function showUsers() {
      let table = "<tr><th>Username</th><th>Role</th><th>Action</th></tr>";
      users.forEach((user, index) => {
        table += `<tr>
          <td>${user.username}</td>
          <td>${user.role}</td>
          <td>
            <button onclick="editUser(${index})">Edit</button>
            <button onclick="deleteUser(${index})">Delete</button>
          </td>
        </tr>`;
      });
      document.getElementById("user-table").innerHTML = table;
    }
    function saveUser() {
      const username = document.getElementById("new-username").value;
      const password = document.getElementById("new-password").value;
      const role = document.getElementById("new-role").value;
      if (!username || !password) return alert("All fields required");
      const existing = users.findIndex(u => u.username === username);
      if (existing !== -1) {
        users[existing] = { username, password, role };
      } else {
        users.push({ username, password, role });
      }
      localStorage.setItem("users", JSON.stringify(users));
      showUsers();
      document.getElementById("new-username").value = '';
      document.getElementById("new-password").value = '';
    }
    function editUser(index) {
      const user = users[index];
      document.getElementById("new-username").value = user.username;
      document.getElementById("new-password").value = user.password;
      document.getElementById("new-role").value = user.role;
    }
    function deleteUser(index) {
      if (confirm("Delete this user?")) {
        users.splice(index, 1);
        localStorage.setItem("users", JSON.stringify(users));
        showUsers();
      }
    }
    showUsers();
  </script>
</body>
</html>